asyncapi: 2.0.0
info:
  title: Zonenalarmsystem - Eventing
  version: '0.0.1'
  description: |
    Dies ist die Event-Dokumenation für das Zonenalarmsystem. Weitere Erläuterungen zum Projekt können dem [Domain Vision Statement](https://github.com/Archi-Lab-FAE/fae-team-2-documentation).

  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  production:
    url: https://fae.archi-lab.io/team-2
    protocol: mqtt
    description: CI/CD-Server
    variables:
      port:
        description: Der Service steht bei allen drei kafka-Servern ("kafka-1:9092", "kafka-2:9092" und "kafka-3:9092") zur Verfügung.

defaultContentType: application/json

channels:

#### SUBSCRIBE ####

  team-1/demenziellerkrankter:
    description: Die Topic, auf welcher Personendaten für Demenziell Erkrankte erzeugt und konsumiert werden.
    subscribe:
      summary: Empfangen aller informationen (create, update, delete) zu Demenziell Erkrankten Personen.
      operationId: receiveDemenziellErkrankte
      traits:
        - $ref: '#/components/operationTraits/kafka'
      message:
        $ref: '#/components/messages/demenziellerkrante'
        
  team-1/positionssender:
    description: Die Topic, auf welcher Positionssender für Demenziell Erkrankte erzeugt und konsumiert werden.
    subscribe:
      summary: Empfangen aller informationen (create, update, delete) zu Positionssendern von Demenziell Erkrankten Personen.
      operationId: receivePositionssender
      traits:
        - $ref: '#/components/operationTraits/kafka'
      message:
        $ref: '#/components/messages/positionssender'


#### PUBLISH ####

  team-3/outOfZone: #schönen Namen einfallen lassen :)
#    parameters:
#      streetlightId:
#        $ref: '#/components/parameters/streetlightId'
    publish:
      operationId: demenziellErkranterOutOfZone
      traits:
        - $ref: '#/components/operationTraits/kafka'
      message:
        $ref: '#/components/messages/outOfZone'


components:
  messages:
    demenziellerkrante:
      name: demenziellerkankte
      title: Demenziell Erkrankte
      summary: Informiert, dass ein Demenziell Erkrankter in das Programm aufgenommen bzw. seine Daten aktualisiert wurden. 
      contentType: application/json
      traits:
        - $ref: '#/components/messageTraits/commonHeaders'
      payload:
        $ref: "#/components/schemas/demenziellerkranktePayload"
        
    positionssender:
      name: posisitionssender
      title: Positionssender
      summary: Informiert, dass ein Positionssneder erstellt, aktualisiert oder gelöscht wurde.
      contentType: application/json
      traits:
        - $ref: '#/components/messageTraits/commonHeaders'
      payload:
        $ref: "#/components/schemas/positionssenderPayload"
        
    outOfZone:
      name: demenziellerkranterabweichung
      title: Demenziell Erkrankter Ausserhalb einer Zone
      summary: Informiert, dass ein Demenziell Erkranter eine GEWOHNTEN Zone verlässt oder eine UNGEWOHNTE Zone betritt.
      contentType: application/json
      traits:
        - $ref: '#/components/messageTraits/commonHeaders'
      payload:
        $ref: "#/components/schemas/outOfZonePayload"

  schemas:
    positionssenderPayload:
      type: object
      properties:
        positionssenderId:
          type: string
          format: uuid-as-string
          example: 'f33c6cd8-1697-11ea-8d71-362b9e155667'
        letztesSignal:
          type: string
          format: date-time
        batterieStatus:
          type: number
          format: float
          example: 0.8
        genauigkeit:
          type: number
          format: float
          example: 1.0
        position:
          $ref: '#/components/schemas/Position'
        sentAt:
          $ref: "#/components/schemas/sentAt"
    
  
    demenziellerkranktePayload:
      type: object
      properties:
        demenziellErkrankterId:
          type: string
          format: uuid-as-string
          example: 'f33c6fa8-1697-11ea-8d71-362b9e155667'
        name:
          type: string
          example: 'K. Löhler'
        zonen:
          type: array
          items:
            $ref: '#/components/schemas/Zone'
        sentAt:
          $ref: "#/components/schemas/sentAt"
            
    outOfZonePayload:
      type: object
      properties:
        demenziellErkrankterId:
          type: string
          format: uuid-as-string
          example: 'f33c6fa8-1697-11ea-8d71-362b9e155667'
        name:
          type: string
          example: 'K. Löhler'
        zonen:
          $ref: '#/components/schemas/Zone'
        aktuellePosition:
          $ref: '#/components/schemas/Position'
        sentAt:
          $ref: "#/components/schemas/sentAt"
                        
            
    Zone:
      type: object
      properties:
        zoneId:
          type: string
          format: uuid-as-string
          example: '8f926d33-27bd-4afd-aabb-b160a6402348'
        toleranz:
          type: number
          format: float
          example: 1.5
        typ:
          $ref: '#/components/schemas/ZonenTyp'
        positionen:
          type: array
          items:
            $ref: '#/components/schemas/Position'

    ZonenTyp:
      type: string
      enum: ['GEWOHNT', 'UNGEWOHNT']
      
    Position:
      type: object
      properties:
        positionsId:
          type: string
          format: uuid-as-string
          example: '65cf7091-e3ac-48e7-8553-c329490aae5c'
        laengengrad:
          type: number
          format: double
          example: '51.042755'
        breitengrad:
          type: number
          format: double
          example: '7.287333'
            
    sentAt:
      type: string
      format: date-time
      description: Datum und Zeit, zu welchem der das Event veröffentlicht wurde.

  messageTraits:
    commonHeaders:
      headers:
        type: object
        properties:
          my-app-header:
            type: integer
            minimum: 0
            maximum: 100

  operationTraits:
    kafka:
      bindings:
        kafka:
          clientId: fae-team-2-service
